<!--pages/history/history.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ğŸ“Š å†å²è®°å½•</text>
    <text class="page-desc">æŸ¥çœ‹ç§¯åˆ†å˜åŠ¨è¯¦æƒ…</text>
  </view>

  <!-- å½“å‰ç§¯åˆ† -->
  <view class="points-info">
    <text class="points-label">å½“å‰ç§¯åˆ†ï¼š</text>
    <text class="points-value">{{userPoints}}</text>
  </view>

  <!-- ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs">
    <view class="tab-item {{activeTab === 'all' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="all">
      å…¨éƒ¨
    </view>
    <view class="tab-item {{activeTab === 'earn' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="earn">
      è·å¾—
    </view>
    <view class="tab-item {{activeTab === 'spend' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="spend">
      æ¶ˆè´¹
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="history-list">
    <view wx:for="{{filteredTransactions}}" wx:key="id" class="history-item">
      <view class="item-icon">
        <text class="icon {{item.type === 'earn' ? 'earn-icon' : 'spend-icon'}}">
          {{item.type === 'earn' ? 'â•' : 'â–'}}
        </text>
      </view>
      
      <view class="item-content">
        <text class="item-title">{{item.description}}</text>
        <text class="item-time">{{item.timeAgo}}</text>
        <text wx:if="{{item.category}}" class="item-category">{{item.category}}</text>
      </view>
      
      <view class="item-amount">
        <text class="amount {{item.type === 'earn' ? 'positive' : 'negative'}}">
          {{item.type === 'earn' ? '+' : '-'}}{{item.amount}}
        </text>
        <text class="amount-label">ç§¯åˆ†</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{filteredTransactions.length === 0}}" class="empty-state">
    <text class="empty-icon">ğŸ“Š</text>
    <text class="empty-text">æš‚æ— è®°å½•</text>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{hasMore && filteredTransactions.length > 0}}" class="load-more" bindtap="loadMore">
    <text wx:if="{{!loading}}">åŠ è½½æ›´å¤š</text>
    <text wx:else>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
  <view wx:if="{{!hasMore && filteredTransactions.length > 0}}" class="no-more">
    <text>æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
  </view>
</view>