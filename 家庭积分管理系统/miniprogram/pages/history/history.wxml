<!--pages/history/history.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">📊 历史记录</text>
    <text class="page-desc">查看积分变动详情</text>
  </view>

  <!-- 当前积分 -->
  <view class="points-info">
    <text class="points-label">当前积分：</text>
    <text class="points-value">{{userPoints}}</text>
  </view>

  <!-- 筛选标签 -->
  <view class="filter-tabs">
    <view class="tab-item {{activeTab === 'all' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="all">
      全部
    </view>
    <view class="tab-item {{activeTab === 'earn' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="earn">
      获得
    </view>
    <view class="tab-item {{activeTab === 'spend' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="spend">
      消费
    </view>
  </view>

  <!-- 记录列表 -->
  <view class="history-list">
    <view wx:for="{{filteredTransactions}}" wx:key="id" class="history-item">
      <view class="item-icon">
        <text class="icon {{item.type === 'earn' ? 'earn-icon' : 'spend-icon'}}">
          {{item.type === 'earn' ? '➕' : '➖'}}
        </text>
      </view>
      
      <view class="item-content">
        <text class="item-title">{{item.description}}</text>
        <text class="item-time">{{item.timeAgo}}</text>
        <text wx:if="{{item.category}}" class="item-category">{{item.category}}</text>
      </view>
      
      <view class="item-amount">
        <text class="amount {{item.type === 'earn' ? 'positive' : 'negative'}}">
          {{item.type === 'earn' ? '+' : '-'}}{{item.amount}}
        </text>
        <text class="amount-label">积分</text>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view wx:if="{{filteredTransactions.length === 0}}" class="empty-state">
    <text class="empty-icon">📊</text>
    <text class="empty-text">暂无记录</text>
  </view>

  <!-- 加载更多 -->
  <view wx:if="{{hasMore && filteredTransactions.length > 0}}" class="load-more" bindtap="loadMore">
    <text wx:if="{{!loading}}">加载更多</text>
    <text wx:else>加载中...</text>
  </view>

  <!-- 没有更多数据 -->
  <view wx:if="{{!hasMore && filteredTransactions.length > 0}}" class="no-more">
    <text>没有更多数据了</text>
  </view>
</view>