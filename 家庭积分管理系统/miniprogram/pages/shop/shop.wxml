<!--pages/shop/shop.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ğŸ›ï¸ ç§¯åˆ†å•†åŸ</text>
    <text class="page-desc">ç”¨ç§¯åˆ†å…‘æ¢å¿ƒä»ªç‰©å“</text>
  </view>

  <!-- å½“å‰ç§¯åˆ† -->
  <view class="points-info">
    <text class="points-label">å½“å‰ç§¯åˆ†ï¼š</text>
    <text class="points-value">{{userPoints}}</text>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="shop-list">
    <view wx:for="{{shopItems}}" wx:key="id" class="shop-item">
      <view class="item-image">
        <image wx:if="{{item.image}}" src="{{item.image}}" class="product-image" mode="aspectFill"></image>
        <view wx:else class="placeholder-image">
          <text class="placeholder-icon">ğŸ“¦</text>
        </view>
      </view>
      
      <view class="item-content">
        <text class="item-title">{{item.name}}</text>
        <text class="item-desc">{{item.description}}</text>
        
        <view class="item-meta">
          <text class="item-stock">åº“å­˜ï¼š{{item.stock}}</text>
          <text class="item-price">{{item.price}} ç§¯åˆ†</text>
        </view>
        
        <view class="item-actions">
          <view class="quantity-selector">
            <button class="quantity-btn" 
                    bindtap="decreaseQuantity" 
                    data-item="{{item}}"
                    disabled="{{item.quantity <= 1}}">-</button>
            <text class="quantity-text">{{item.quantity || 1}}</text>
            <button class="quantity-btn" 
                    bindtap="increaseQuantity" 
                    data-item="{{item}}"
                    disabled="{{item.quantity >= item.stock}}">+</button>
          </view>
          
          <button class="purchase-btn {{item.price > userPoints ? 'disabled' : ''}}"
                  bindtap="purchaseItem" 
                  data-item="{{item}}"
                  disabled="{{item.price > userPoints || item.stock <= 0}}">
            <text wx:if="{{item.price > userPoints}}">ç§¯åˆ†ä¸è¶³</text>
            <text wx:elif="{{item.stock <= 0}}">ç¼ºè´§</text>
            <text wx:else>ç«‹å³è´­ä¹°</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{shopItems.length === 0}}" class="empty-state">
    <text class="empty-icon">ğŸ›ï¸</text>
    <text class="empty-text">æš‚æ— å•†å“</text>
  </view>

  <!-- è´­ä¹°ç¡®è®¤å¼¹çª— -->
  <view wx:if="{{showPurchaseModal}}" class="purchase-modal">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ç¡®è®¤è´­ä¹°</text>
        <text class="modal-close" bindtap="closePurchaseModal">Ã—</text>
      </view>
      
      <view class="modal-body">
        <view class="purchase-item">
          <image wx:if="{{selectedItem.image}}" src="{{selectedItem.image}}" class="purchase-image" mode="aspectFill"></image>
          <view wx:else class="purchase-placeholder">
            <text class="placeholder-icon">ğŸ“¦</text>
          </view>
          
          <view class="purchase-info">
            <text class="purchase-name">{{selectedItem.name}}</text>
            <text class="purchase-desc">{{selectedItem.description}}</text>
            <text class="purchase-quantity">æ•°é‡ï¼š{{selectedItem.quantity}}</text>
          </view>
        </view>
        
        <view class="purchase-summary">
          <view class="summary-row">
            <text class="summary-label">å•ä»·ï¼š</text>
            <text class="summary-value">{{selectedItem.price}} ç§¯åˆ†</text>
          </view>
          <view class="summary-row">
            <text class="summary-label">æ•°é‡ï¼š</text>
            <text class="summary-value">{{selectedItem.quantity}}</text>
          </view>
          <view class="summary-row total">
            <text class="summary-label">æ€»è®¡ï¼š</text>
            <text class="summary-value">{{selectedItem.price * selectedItem.quantity}} ç§¯åˆ†</text>
          </view>
          <view class="summary-row">
            <text class="summary-label">ä½™é¢ï¼š</text>
            <text class="summary-value">{{userPoints}} ç§¯åˆ†</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-cancel" bindtap="closePurchaseModal">å–æ¶ˆ</button>
        <button class="btn btn-confirm" bindtap="confirmPurchase" disabled="{{purchasing}}">
          <text wx:if="{{!purchasing}}">ç¡®è®¤è´­ä¹°</text>
          <text wx:else>è´­ä¹°ä¸­...</text>
        </button>
      </view>
    </view>
  </view>

  <!-- è´­ä¹°æˆåŠŸæç¤º -->
  <view wx:if="{{showSuccess}}" class="success-modal">
    <view class="modal-content">
      <text class="success-icon">âœ…</text>
      <text class="success-title">è´­ä¹°æˆåŠŸï¼</text>
      <text class="success-desc">å•†å“å·²åŠ å…¥æ‚¨çš„è´¦æˆ·</text>
      <button class="btn btn-primary" bindtap="closeSuccess">ç¡®å®š</button>
    </view>
  </view>
</view>